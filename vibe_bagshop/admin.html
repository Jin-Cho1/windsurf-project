<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상품 등록 | Vibe Bagshop</title>
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .admin-page {
        min-height: 100vh;
        background: #f9fafb;
        padding: 80px 24px;
      }
      .admin-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 48px;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
      }
      .admin-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .admin-sub {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 32px;
      }
      .form-group {
        margin-bottom: 24px;
      }
      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
      }
      .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s;
      }
      .form-input:focus {
        outline: none;
        border-color: #3b82f6;
      }
      .form-help {
        font-size: 12px;
        color: #9ca3af;
        margin-top: 4px;
      }
      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }
      .admin-footer {
        margin-top: 32px;
        padding-top: 24px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .admin-footer a {
        color: #3b82f6;
        font-weight: 500;
      }
      .admin-footer a:hover {
        text-decoration: underline;
      }
      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: #111827;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        opacity: 0;
        transition: transform 0.3s, opacity 0.3s;
        z-index: 1000;
      }
      .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div class="admin-page">
      <div class="admin-container">
        <h1 class="admin-title">상품 등록</h1>
        <p class="admin-sub">Vibe Bagshop에 새로운 상품을 추가하세요.</p>

        <form id="productForm">
          <div class="form-group">
            <label class="form-label" for="productName">상품명 *</label>
            <input class="form-input" id="productName" type="text" required placeholder="예: Vibe Tote" />
          </div>

          <div class="form-group">
            <label class="form-label" for="productPrice">가격 *</label>
            <input class="form-input" id="productPrice" type="text" required placeholder="예: ₩149,000" />
            <p class="form-help">₩ 포함해서 입력해주세요.</p>
          </div>

          <div class="form-group">
            <label class="form-label" for="productDesc">설명</label>
            <textarea class="form-input" id="productDesc" rows="3" placeholder="상품 설명을 입력하세요"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="productImage">상품 이미지 *</label>
            <input class="form-input" id="productImage" type="file" accept="image/*" required />
            <p class="form-help">JPG, PNG, GIF (최대 5MB)</p>
            <div id="imagePreview" style="margin-top:12px;"></div>
          </div>

          <div class="form-group">
            <label class="form-label" for="productSection">배치 섹션 *</label>
            <select class="form-input" id="productSection" required>
              <option value="">선택하세요</option>
              <option value="popular">인기상품</option>
              <option value="new">신상품</option>
              <option value="md">MD 추천</option>
            </select>
            <p class="form-help">MD 추천은 1개만 표시되며, 등록 시 기존 상품을 덮어씁니다.</p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn--ghost" id="resetBtn">초기화</button>
            <button type="submit" class="btn btn--primary">등록하기</button>
          </div>
        </form>

        <div class="admin-footer">
          <a href="index.html">← 쇼핑몰 보기</a>
          <span id="productCount">등록된 상품: 0개</span>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
      // 상품 목록 로드
      function loadProducts() {
        const raw = localStorage.getItem('vibeBagshopProducts');
        return raw ? JSON.parse(raw) : [];
      }

      // 상품 저장
      function saveProducts(products) {
        localStorage.setItem('vibeBagshopProducts', JSON.stringify(products));
      }

      // 토스트 알림
      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }

      // 상품 수 업데이트
      function updateCount() {
        const products = loadProducts();
        document.getElementById('productCount').textContent = `등록된 상품: ${products.length}개`;
      }

      // 폼 리셋
      function resetForm() {
        document.getElementById('productForm').reset();
        document.getElementById('imagePreview').innerHTML = '';
      }

      // 이미지 미리보기
      document.getElementById('productImage').addEventListener('change', (e) => {
        const file = e.target.files[0];
        const preview = document.getElementById('imagePreview');
        if (!file) {
          preview.innerHTML = '';
          return;
        }
        if (!file.type.startsWith('image/')) {
          showToast('이미지 파일만 선택 가능합니다.');
          e.target.value = '';
          preview.innerHTML = '';
          return;
        }
        if (file.size > 5 * 1024 * 1024) {
          showToast('5MB 이하의 이미지만 등록 가능합니다.');
          e.target.value = '';
          preview.innerHTML = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.innerHTML = `<img src="${e.target.result}" style="max-width:200px;max-height:200px;border-radius:8px;border:1px solid #e5e7eb;">`;
        };
        reader.readAsDataURL(file);
      });

      // 등록 처리
      document.getElementById('productForm').addEventListener('submit', (e) => {
        e.preventDefault();

        const name = document.getElementById('productName').value.trim();
        const price = document.getElementById('productPrice').value.trim();
        const desc = document.getElementById('productDesc').value.trim();
        const imageFile = document.getElementById('productImage').files[0];
        const section = document.getElementById('productSection').value;

        if (!name || !price || !imageFile || !section) {
          showToast('필수 항목을 모두 입력해주세요.');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          const newProduct = {
            id: Date.now(),
            name,
            price,
            desc: desc || '상품 설명이 없습니다.',
            image: e.target.result, // Base64
          };

          if (section === 'popular') {
            const products = loadProducts();
            products.push(newProduct);
            saveProducts(products);
          } else if (section === 'new') {
            const newProds = loadNewProducts();
            newProds.push(newProduct);
            saveNewProducts(newProds);
          } else if (section === 'md') {
            saveMDProduct(newProduct);
          }

          showToast('상품이 등록되었습니다!');
          resetForm();
          updateCount();
        };
        reader.readAsDataURL(imageFile);
      });

      // 신상품 로드/저장
      function loadNewProducts() {
        const raw = localStorage.getItem('vibeBagshopNewProducts');
        return raw ? JSON.parse(raw) : [];
      }
      function saveNewProducts(arr) {
        localStorage.setItem('vibeBagshopNewProducts', JSON.stringify(arr));
      }

      // MD 추천 로드/저장 (1개만)
      function loadMDProduct() {
        const raw = localStorage.getItem('vibeBagshopMDProduct');
        return raw ? JSON.parse(raw) : null;
      }
      function saveMDProduct(prod) {
        localStorage.setItem('vibeBagshopMDProduct', JSON.stringify(prod));
      }

      // 상품 수 업데이트 (섹션별)
      function updateCount() {
        const popular = loadProducts().length;
        const newProds = loadNewProducts().length;
        const md = loadMDProduct() ? 1 : 0;
        document.getElementById('productCount').textContent = `인기 ${popular} / 신상 ${newProds} / MD ${md}`;
      }

      // 초기화 버튼
      document.getElementById('resetBtn').addEventListener('click', resetForm);

      // 초기 렌더
      updateCount();
    </script>
  </body>
</html>
